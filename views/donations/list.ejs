<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>

  <%- include('../partials/_nav') %>
  <%- include('../partials/_flash') %>

  <div class="page-wrap">
    <div class="page">
      <h1>Donations</h1>

      <p><a class="button-link" href="/donations/new">Add Donation</a></p>

      <%
        const formatDate = (val) => {
          if (!val) return '';
          try {
            return new Date(val).toISOString().slice(0, 10);
          } catch (e) {
            return val;
          }
        };
      %>

      <table>
        <thead>
          <tr>
            <th>Donor</th>
            <th>Email</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% donations.forEach(d => { %>
            <tr>
              <td><%= (d.first_name || '') + (d.last_name ? ' ' + d.last_name : '') || 'â€”' %></td>
              <td><%= d.email %></td>
              <td><%= formatDate(d.date) %></td>
              <td>$<%= Number(d.amount || 0).toFixed(2) %></td>
              <td class="actions">
                <a href="/donations/<%= d.id %>/edit">Edit</a>
                <form action="/donations/<%= d.id %>/delete" method="POST" style="display:inline;">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button type="submit">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

</body>
</html>
