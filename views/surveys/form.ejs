<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>

<%- include('../partials/_nav') %>
<%- include('../partials/_flash') %>

<h1><%= title %></h1>

<form action="<%= survey.id ? '/surveys/' + survey.id : '/surveys' %>" method="POST">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <% if (currentUser.role === 'manager') { %>

    <!-- Manager-only participant selection -->
    <label>Participant</label><br>
    <select name="participant_id" required>
      <option value="">Select participant</option>
      <% participants.forEach(p => { %>
        <option
          value="<%= p.id %>"
          <%= survey.participant_id === p.id ? 'selected' : '' %>
        >
          <%= p.first_name %> <%= p.last_name %> (#<%= p.id %>)
        </option>
      <% }) %>
    </select>
    <br><br>

  <% } else { %>

    <!-- Hidden participant_id for normal users -->
    <input type="hidden" name="participant_id" value="<%= currentUser.participant_id %>">

    <p>
      <strong>Participant:</strong>
      <%= currentUser.email %><br>
    </p>

  <% } %>

  <!-- Event selection (both roles) -->
  <label>Event</label><br>
  <select name="event_id" required>
    <option value="">Select event</option>
    <% events.forEach(e => { %>
      <option
        value="<%= e.id %>"
        <%= survey.event_id === e.id ? 'selected' : '' %>
      >
        <%= e.name %> (#<%= e.id %>)
      </option>
    <% }) %>
  </select>
  <br><br>

  <label>Satisfaction (1–5)</label><br>
  <input
    type="number"
    name="satisfaction_rating"
    min="1"
    max="5"
    value="<%= survey.satisfaction_rating || '' %>"
    required
  >
  <br><br>

  <label>Usefulness (1–5)</label><br>
  <input
    type="number"
    name="usefulness_rating"
    min="1"
    max="5"
    value="<%= survey.usefulness_rating || '' %>"
    required
  >
  <br><br>

  <label>Recommend (1–10)</label><br>
  <input
    type="number"
    name="recommend_rating"
    min="1"
    max="10"
    value="<%= survey.recommend_rating || '' %>"
    required
  >
  <br><br>

  <label>Comments</label><br>
  <textarea name="comments" rows="4" cols="40"><%= survey.comments || '' %></textarea>
  <br><br>

  <button type="submit"><%= survey.id ? "Update Survey" : "Submit Survey" %></button>
</form>

</body>
</html>

