<!DOCTYPE html>
<html>
<head>
  <title>Surveys</title>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>

<%- include('../partials/_nav') %>
<%- include('../partials/_flash') %>

<h1>Surveys</h1>

<% if (currentUser.role === 'manager') { %>
  <p><a href="/surveys/new">Add Survey</a></p>
<% } %>

<table border="1" cellpadding="6">
  <tr>
    <th>Participant</th>
    <th>Event</th>
    <th>Satisfaction (1–5)</th>
    <th>Usefulness (1–5)</th>
    <th>Recommend (1–10)</th>
    <th>Comments</th>
    <% if (currentUser.role === 'manager') { %>
      <th>Actions</th>
    <% } %>
  </tr>

  <% surveys.forEach(s => { %>
    <tr>
      <td><%= s.participant_name || ('#' + s.participant_id) %></td>
      <td><%= s.event_name || ('#' + s.event_id) %></td>
      <td><%= s.satisfaction_rating %></td>
      <td><%= s.usefulness_rating %></td>
      <td><%= s.recommend_rating %></td>
      <td><%= s.comments || '' %></td>

      <% if (currentUser.role === 'manager') { %>
        <td>
          <a href="/surveys/<%= s.id %>/edit">Edit</a>
          <form action="/surveys/<%= s.id %>/delete" method="POST" style="display:inline;">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit">Delete</button>
          </form>
        </td>
      <% } %>
    </tr>
  <% }) %>
</table>

</body>
</html>
