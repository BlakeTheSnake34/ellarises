<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/main.css">

  <style>
    .pagination-container {
      margin-top: 1.5rem;
      text-align: right;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: .75rem;
      flex-wrap: wrap;
    }

    .page-input {
      width: 70px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }

    .participants-table th,
    .participants-table td {
      text-align: left;
      padding: .4rem .6rem;
    }
  </style>
</head>
<body>

  <%- include('../partials/_nav') %>
  <%- include('../partials/_flash') %>

  <div class="page-wrap">
    <div class="page">
      <h1><%= title %></h1>

      <!-- Search bar -->
      <form method="GET" action="/participants" class="form-row" style="margin-bottom: 1rem;">
        <input
          type="text"
          name="q"
          placeholder="Search by name or email"
          value="<%= q || '' %>"
          style="max-width: 260px;"
        >
        <button type="submit" class="button-secondary">Search</button>

        <% if (q) { %>
          <a href="/participants" class="button-secondary" style="margin-left: 0.5rem;">Clear</a>
        <% } %>
      </form>

      <p>
        <a href="/participants/new" class="btn-add">+ Add Participant</a>
      </p>

      <table class="participants-table">
        <thead>
          <tr>
            <th>Email</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>DOB</th>
            <th>Phone</th>
            <th>School or Employer</th>
            <th>Field of Interest</th>
            <th>Zip</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% if (participants && participants.length) { %>
            <% participants.forEach(p => { %>
              <tr>
                <td><%= p.participantemail %></td>
                <td><%= p.participantfirstname %></td>
                <td><%= p.participantlastname %></td>
                <td><%= p.participantdob ? String(p.participantdob).slice(0, 10) : '' %></td>
                <td><%= p.participantphone %></td>
                <td><%= p.participantschooloremployer %></td>
                <td><%= p.participantfieldofinterest %></td>
                <td><%= p.participantzip %></td>

                <td class="action-cell">
                  <a href="/participants/<%= p.id %>/edit" class="btn-edit">Edit</a>

                  <form action="/participants/<%= p.id %>/delete"
                        method="POST"
                        style="display:inline;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn-delete">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="9">No participants found.</td>
            </tr>
          <% } %>
        </tbody>
      </table>

      <!-- ========================= -->
      <!-- COMPACT PAGINATION + JUMP -->
      <!-- ========================= -->
      <% if (totalPages && totalPages > 1) { %>
        <div class="pagination-container">

          <!-- Prev -->
          <% if (currentPage > 1) { %>
            <a class="btn-edit"
              href="/participants?page=<%= currentPage - 1 %><%= q ? '&q=' + q : '' %>">
              ← Prev
            </a>
          <% } else { %>
            <span class="btn-edit" style="opacity: .4; pointer-events:none;">← Prev</span>
          <% } %>

          <!-- Page display -->
          <span style="font-weight:600;">
            Page <%= currentPage %> of <%= totalPages %>
          </span>

          <!-- Jump-to-page input -->
          <form method="GET" action="/participants" style="display:flex; align-items:center; gap:.4rem;">
            <input type="hidden" name="q" value="<%= q || '' %>">

            <input
              type="number"
              name="page"
              min="1"
              max="<%= totalPages %>"
              class="page-input"
              placeholder="Page"
            >
            <button type="submit" class="btn-edit">Go</button>
          </form>

          <!-- Next -->
          <% if (currentPage < totalPages) { %>
            <a class="btn-edit"
              href="/participants?page=<%= currentPage + 1 %><%= q ? '&q=' + q : '' %>">
              Next →
            </a>
          <% } else { %>
            <span class="btn-edit" style="opacity: .4; pointer-events:none;">Next →</span>
          <% } %>

        </div>
      <% } %>

    </div>
  </div>
  <%- include('../partials/_footer') %>
</body>
</html>
